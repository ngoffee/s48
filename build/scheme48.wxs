<?xml version="1.0" encoding="windows-1252"?>

<!-- Copyright (c) 1993-2005 by Richard Kelsey and Jonathan Rees. See file COPYING. -->

<!-- WiX source file for building a Windows .msi installer for Scheme 48 -->

<!-- To build, fire up Cygwin, cd to the source directory, and do:
     build/generate-scheme48-files-wxi.sh "./scheme48vm -i scheme48.image"
     candle build/scheme48.wxs
     light scheme48.wixobj
-->

<Wix xmlns="http://schemas.microsoft.com/wix/2003/01/wi">

  <!-- TODO:
       - minimal GUI
       - batch file front end for Scheme 48
       - proper uninstall with deletion
   -->
       
  <Product 
    Id="09642823-3266-4703-bcd3-ad98302f35ad"
    Name="Scheme 48 1.3"
    Version="1.3"
    Manufacturer="The Scheme 48 Maintainers, s48-info@s48.org"
    Codepage="1252"
    Language="1033">

    <Package 
      Id="20185933-8f9f-4f55-9afa-58f6b4f5ed78"
      Description="Scheme 48"
      Comments="Scheme 48 Development System"
      Manufacturer="The Scheme 48 Maintainers"
      InstallerVersion="110"
      Platforms="Intel"
      Languages="1033"
      Compressed="yes" />

    <Condition Message="This software only runs on Windows NT 4.0/2000/XP.">
      VersionNT
    </Condition>

    <Media Id="1" EmbedCab="yes" Cabinet="scheme48.cab" />

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder" Name="PFiles">
        <Directory Id="Scheme48" Name="Scheme48" LongName="Scheme 48">
          <Directory Id="INSTALLDIR" Name="s48_1-3" LongName="Scheme 48 1.3">

            <Component Id="Main" Guid="47e7eda2-b740-4c68-ba6b-79ab5f02920a">

              <File Id="Scheme48VM" Name="S48VM.EXE" LongName="scheme48vm.exe" DiskId="1"
                src="scheme48vm.exe" Vital="yes" />

              <File Id="Scheme48VM.lib" Name="S48VM.LIB" LongName="scheme48vm.lib" DiskId="1"
                src="scheme48vm.lib" Vital="yes" />

              <Shortcut Id="start_menu_entry" Directory="ProgramMenuDir"
                Description="Scheme 48 Console"
                Name="s48_1-3" 
                LongName="Scheme 48 1.3"
                Target="[#Scheme48VM]"
                Arguments='-i "[INSTALLDIR]scheme48.image"'
                WorkingDirectory="INSTALLDIR"
                Icon="scheme48.ico" IconIndex="0"
                Show="normal" />

              <Shortcut Id="doc_html_menu_entry" Directory="ProgramMenuDir"
                Description="Scheme 48 HTML Documentation"
                Name="s48h_1-3" 
                LongName="Scheme 48 1.3 HTML Documentation"
                Target="[#doc_html_manual.html]"
                Show="normal" />

              <Shortcut Id="doc_pdf_menu_entry" Directory="ProgramMenuDir"
                Description="Scheme 48 PDF Documentation"
                Name="s48p_1-3" 
                LongName="Scheme 48 1.3 PDF Documentation"
                Target="[#doc_manual.pdf]"
                Show="normal" />

              <File Id="COPYING" Name="COPYING" LongName="COPYING" DiskId="1"
                src="COPYING" Vital="yes" />

            </Component>

            <?include scheme48-files.wxi ?>

            <Directory Id="include" Name="INCLUDE" LongName="include" >
              <Component Id="include_component" Guid="67f000c9-326c-40a7-a228-6f2e37111f77">
                <File Id="include_scheme48.h"
                      Name="SCHEME48.H" LongName="scheme48.h"
                      src="c/scheme48.h"
                      DiskId="1" Vital="yes" />

                <File Id="include_scheme48write-barrier.h"
                      Name="SCHEME~1.H" LongName="scheme48write-barrier.h"
                      src="c/scheme48write-barrier.h"
                      DiskId="1" Vital="yes" />
              </Component>
            </Directory>

            <Directory Id="build" Name="BUILD" LongName="build" >
              <Component Id="build_component" Guid="09454a52-e0c8-4630-ab19-05ca78900f4b">

                <File Id="build_initial.image" Name="INITIAL.IMA" LongName="initial.image" DiskId="1"
                      src="build/initial.image" Vital="yes" />
                <File Id="build_initial.debug" Name="INITIAL.DEB" LongName="initial.debug" DiskId="1"
                      src="build/initial.debug" Vital="yes" />
                <File Id="build_initial.scm" Name="INITIAL.SCM" LongName="initial.scm" DiskId="1"
                      src="build/initial.scm" Vital="yes" />

                <File Id="build_build_usual_image.bat"
                      Name="BUILD-~1.BAT" LongName="build-usual-image.bat"
                      src="build/build-usual-image.bat"
                      DiskId="1" Vital="yes" />
              </Component>
            </Directory>

          </Directory>
        </Directory>
      </Directory>

      <Directory Id="ProgramMenuFolder" Name="PMenu" LongName="Programs">
        <Directory Id="ProgramMenuDir" Name="scheme48" LongName="Scheme 48" />
      </Directory>

      <Directory Id="DesktopFolder" Name="Desktop" />

    </Directory>

    <!-- declare building of scheme48.image -->
    <CustomAction Id="build_usual_image"
                  FileKey="build_build_usual_image.bat"
                  ExeCommand='"[INSTALLDIR]" "[INSTALLDIR]scheme" "[INSTALLDIR]scheme48.image" "[INSTALLDIR]scheme48vm.exe" "[INSTALLDIR]build\initial.image"'
                  Return="check" />

    <Icon Id="scheme48.ico" src="build/scheme48.ico" />

    <Feature Id="Complete" Level="1"
             Title="Scheme 48 1.3"
             Description="Scheme 48 1.3 main installation"
             ConfigurableDirectory="INSTALLDIR">
      <ComponentRef Id="Main" />
      <ComponentRef Id="include_component" />
      <ComponentRef Id="build_component" />

      <ComponentRef Id="scheme_component" />
      <ComponentRef Id="scheme_env_component" />
      <ComponentRef Id="scheme_big_component" />
      <ComponentRef Id="scheme_sort_component" />
      <ComponentRef Id="scheme_misc_component" />
      <ComponentRef Id="scheme_cml_component" />
      <ComponentRef Id="scheme_srfi_component" />
      <ComponentRef Id="scheme_rts_component" />
      <ComponentRef Id="scheme_posix_component" />

      <ComponentRef Id="doc_component" />
      <ComponentRef Id="doc_html_component" />
    </Feature>

    <!-- schedule the building of scheme48.image -->
    <InstallExecuteSequence>
      <Custom Action="build_usual_image" After="InstallFinalize">NOT Installed</Custom>
    </InstallExecuteSequence>

</Product>

</Wix>
